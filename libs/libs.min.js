var Base64=(function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var b={encode:function(e){var c="";var m,k,h;var l,j,g,f;var d=0;do{m=e.charCodeAt(d++);k=e.charCodeAt(d++);h=e.charCodeAt(d++);l=m>>2;j=((m&3)<<4)|(k>>4);g=((k&15)<<2)|(h>>6);f=h&63;if(isNaN(k)){g=f=64}else{if(isNaN(h)){f=64}}c=c+a.charAt(l)+a.charAt(j)+a.charAt(g)+a.charAt(f)}while(d<e.length);return c},decode:function(e){var c="";var m,k,h;var l,j,g,f;var d=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{l=a.indexOf(e.charAt(d++));j=a.indexOf(e.charAt(d++));g=a.indexOf(e.charAt(d++));f=a.indexOf(e.charAt(d++));m=(l<<2)|(j>>4);k=((j&15)<<4)|(g>>2);h=((g&3)<<6)|f;c=c+String.fromCharCode(m);if(g!=64){c=c+String.fromCharCode(k)}if(f!=64){c=c+String.fromCharCode(h)}}while(d<e.length);return c}};return b})();var MD5=(function(){var p=0;var a="";var m=8;var k=function(s,v){var u=(s&65535)+(v&65535);var t=(s>>16)+(v>>16)+(u>>16);return(t<<16)|(u&65535)};var o=function(s,t){return(s<<t)|(s>>>(32-t))};var b=function(v){var u=[];var s=(1<<m)-1;for(var t=0;t<v.length*m;t+=m){u[t>>5]|=(v.charCodeAt(t/m)&s)<<(t%32)}return u};var g=function(u){var v="";var s=(1<<m)-1;for(var t=0;t<u.length*32;t+=m){v+=String.fromCharCode((u[t>>5]>>>(t%32))&s)}return v};var r=function(u){var t=p?"0123456789ABCDEF":"0123456789abcdef";var v="";for(var s=0;s<u.length*4;s++){v+=t.charAt((u[s>>2]>>((s%4)*8+4))&15)+t.charAt((u[s>>2]>>((s%4)*8))&15)}return v};var q=function(v){var u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var x="";var w,s;for(var t=0;t<v.length*4;t+=3){w=(((v[t>>2]>>8*(t%4))&255)<<16)|(((v[t+1>>2]>>8*((t+1)%4))&255)<<8)|((v[t+2>>2]>>8*((t+2)%4))&255);for(s=0;s<4;s++){if(t*8+s*6>v.length*32){x+=a}else{x+=u.charAt((w>>6*(3-s))&63)}}}return x};var d=function(A,w,v,u,z,y){return k(o(k(k(w,A),k(u,y)),z),v)};var l=function(w,v,B,A,u,z,y){return d((v&B)|((~v)&A),w,v,u,z,y)};var c=function(w,v,B,A,u,z,y){return d((v&A)|(B&(~A)),w,v,u,z,y)};var n=function(w,v,B,A,u,z,y){return d(v^B^A,w,v,u,z,y)};var j=function(w,v,B,A,u,z,y){return d(B^(v|(~A)),w,v,u,z,y)};var f=function(D,y){D[y>>5]|=128<<((y)%32);D[(((y+64)>>>9)<<4)+14]=y;var C=1732584193;var B=-271733879;var A=-1732584194;var z=271733878;var w,v,u,s;for(var t=0;t<D.length;t+=16){w=C;v=B;u=A;s=z;C=l(C,B,A,z,D[t+0],7,-680876936);z=l(z,C,B,A,D[t+1],12,-389564586);A=l(A,z,C,B,D[t+2],17,606105819);B=l(B,A,z,C,D[t+3],22,-1044525330);C=l(C,B,A,z,D[t+4],7,-176418897);z=l(z,C,B,A,D[t+5],12,1200080426);A=l(A,z,C,B,D[t+6],17,-1473231341);B=l(B,A,z,C,D[t+7],22,-45705983);C=l(C,B,A,z,D[t+8],7,1770035416);z=l(z,C,B,A,D[t+9],12,-1958414417);A=l(A,z,C,B,D[t+10],17,-42063);B=l(B,A,z,C,D[t+11],22,-1990404162);C=l(C,B,A,z,D[t+12],7,1804603682);z=l(z,C,B,A,D[t+13],12,-40341101);A=l(A,z,C,B,D[t+14],17,-1502002290);B=l(B,A,z,C,D[t+15],22,1236535329);C=c(C,B,A,z,D[t+1],5,-165796510);z=c(z,C,B,A,D[t+6],9,-1069501632);A=c(A,z,C,B,D[t+11],14,643717713);B=c(B,A,z,C,D[t+0],20,-373897302);C=c(C,B,A,z,D[t+5],5,-701558691);z=c(z,C,B,A,D[t+10],9,38016083);A=c(A,z,C,B,D[t+15],14,-660478335);B=c(B,A,z,C,D[t+4],20,-405537848);C=c(C,B,A,z,D[t+9],5,568446438);z=c(z,C,B,A,D[t+14],9,-1019803690);A=c(A,z,C,B,D[t+3],14,-187363961);B=c(B,A,z,C,D[t+8],20,1163531501);C=c(C,B,A,z,D[t+13],5,-1444681467);z=c(z,C,B,A,D[t+2],9,-51403784);A=c(A,z,C,B,D[t+7],14,1735328473);B=c(B,A,z,C,D[t+12],20,-1926607734);C=n(C,B,A,z,D[t+5],4,-378558);z=n(z,C,B,A,D[t+8],11,-2022574463);A=n(A,z,C,B,D[t+11],16,1839030562);B=n(B,A,z,C,D[t+14],23,-35309556);C=n(C,B,A,z,D[t+1],4,-1530992060);z=n(z,C,B,A,D[t+4],11,1272893353);A=n(A,z,C,B,D[t+7],16,-155497632);B=n(B,A,z,C,D[t+10],23,-1094730640);C=n(C,B,A,z,D[t+13],4,681279174);z=n(z,C,B,A,D[t+0],11,-358537222);A=n(A,z,C,B,D[t+3],16,-722521979);B=n(B,A,z,C,D[t+6],23,76029189);C=n(C,B,A,z,D[t+9],4,-640364487);z=n(z,C,B,A,D[t+12],11,-421815835);A=n(A,z,C,B,D[t+15],16,530742520);B=n(B,A,z,C,D[t+2],23,-995338651);C=j(C,B,A,z,D[t+0],6,-198630844);z=j(z,C,B,A,D[t+7],10,1126891415);A=j(A,z,C,B,D[t+14],15,-1416354905);B=j(B,A,z,C,D[t+5],21,-57434055);C=j(C,B,A,z,D[t+12],6,1700485571);z=j(z,C,B,A,D[t+3],10,-1894986606);A=j(A,z,C,B,D[t+10],15,-1051523);B=j(B,A,z,C,D[t+1],21,-2054922799);C=j(C,B,A,z,D[t+8],6,1873313359);z=j(z,C,B,A,D[t+15],10,-30611744);A=j(A,z,C,B,D[t+6],15,-1560198380);B=j(B,A,z,C,D[t+13],21,1309151649);C=j(C,B,A,z,D[t+4],6,-145523070);z=j(z,C,B,A,D[t+11],10,-1120210379);A=j(A,z,C,B,D[t+2],15,718787259);B=j(B,A,z,C,D[t+9],21,-343485551);C=k(C,w);B=k(B,v);A=k(A,u);z=k(z,s)}return[C,B,A,z]};var e=function(u,x){var w=b(u);if(w.length>16){w=f(w,u.length*m)}var s=new Array(16),v=new Array(16);for(var t=0;t<16;t++){s[t]=w[t]^909522486;v[t]=w[t]^1549556828}var y=f(s.concat(b(x)),512+x.length*m);return f(v.concat(y),512+128)};var h={hexdigest:function(t){return r(f(b(t),t.length*m))},b64digest:function(t){return q(f(b(t),t.length*m))},hash:function(t){return g(f(b(t),t.length*m))},hmac_hexdigest:function(s,t){return r(e(s,t))},hmac_b64digest:function(s,t){return q(e(s,t))},hmac_hash:function(s,t){return g(e(s,t))},test:function(){return MD5.hexdigest("abc")==="900150983cd24fb0d6963f7d28e17f72"}};return h})();if(!Function.prototype.bind){Function.prototype.bind=function(e){var d=this;var c=Array.prototype.slice;var b=Array.prototype.concat;var a=c.call(arguments,1);return function(){return d.apply(e?e:this,b.call(a,c.call(arguments,0)))}}}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(b){var a=this.length;var c=Number(arguments[1])||0;c=(c<0)?Math.ceil(c):Math.floor(c);if(c<0){c+=a}for(;c<a;c++){if(c in this&&this[c]===b){return c}}return -1}}(function(f){var e;function c(h,g){return new e.Builder(h,g)}function a(g){return new e.Builder("message",g)}function d(g){return new e.Builder("iq",g)}function b(g){return new e.Builder("presence",g)}e={VERSION:"51e2a54",NS:{CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas"},addNamespace:function(g,h){e.NS[g]=h},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3},forEachChild:function(k,l,j){var h,g;for(h=0;h<k.childNodes.length;h++){g=k.childNodes[h];if(g.nodeType==e.ElementType.NORMAL&&(!l||this.isTagEqual(g,l))){j(g)}}},isTagEqual:function(h,g){return h.tagName.toLowerCase()==g.toLowerCase()},_xmlGenerator:null,_makeGenerator:function(){var g;if(window.ActiveXObject){g=this._getIEXmlDom();g.appendChild(g.createElement("strophe"))}else{g=document.implementation.createDocument("jabber:client","strophe",null)}return g},xmlGenerator:function(){if(!e._xmlGenerator){e._xmlGenerator=e._makeGenerator()}return e._xmlGenerator},_getIEXmlDom:function(){var h=null;var k=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"];for(var j=0;j<k.length;j++){if(h===null){try{h=new ActiveXObject(k[j])}catch(g){h=null}}else{break}}return h},xmlElement:function(j){if(!j){return null}var m=e.xmlGenerator().createElement(j);var g,l,h;for(g=1;g<arguments.length;g++){if(!arguments[g]){continue}if(typeof(arguments[g])=="string"||typeof(arguments[g])=="number"){m.appendChild(e.xmlTextNode(arguments[g]))}else{if(typeof(arguments[g])=="object"&&typeof(arguments[g].sort)=="function"){for(l=0;l<arguments[g].length;l++){if(typeof(arguments[g][l])=="object"&&typeof(arguments[g][l].sort)=="function"){m.setAttribute(arguments[g][l][0],arguments[g][l][1])}}}else{if(typeof(arguments[g])=="object"){for(h in arguments[g]){if(arguments[g].hasOwnProperty(h)){m.setAttribute(h,arguments[g][h])}}}}}}return m},xmlescape:function(g){g=g.replace(/\&/g,"&amp;");g=g.replace(/</g,"&lt;");g=g.replace(/>/g,"&gt;");return g},xmlTextNode:function(g){g=e.xmlescape(g);return e.xmlGenerator().createTextNode(g)},getText:function(h){if(!h){return null}var j="";if(h.childNodes.length===0&&h.nodeType==e.ElementType.TEXT){j+=h.nodeValue}for(var g=0;g<h.childNodes.length;g++){if(h.childNodes[g].nodeType==e.ElementType.TEXT){j+=h.childNodes[g].nodeValue}}return j},copyElement:function(j){var g,h;if(j.nodeType==e.ElementType.NORMAL){h=e.xmlElement(j.tagName);for(g=0;g<j.attributes.length;g++){h.setAttribute(j.attributes[g].nodeName.toLowerCase(),j.attributes[g].value)}for(g=0;g<j.childNodes.length;g++){h.appendChild(e.copyElement(j.childNodes[g]))}}else{if(j.nodeType==e.ElementType.TEXT){h=e.xmlTextNode(j.nodeValue)}}return h},escapeNode:function(g){return g.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(g){return g.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(g){if(g.indexOf("@")<0){return null}return g.split("@")[0]},getDomainFromJid:function(g){var h=e.getBareJidFromJid(g);if(h.indexOf("@")<0){return h}else{var j=h.split("@");j.splice(0,1);return j.join("@")}},getResourceFromJid:function(g){var h=g.split("/");if(h.length<2){return null}h.splice(0,1);return h.join("/")},getBareJidFromJid:function(g){return g?g.split("/")[0]:null},log:function(h,g){return},debug:function(g){this.log(this.LogLevel.DEBUG,g)},info:function(g){this.log(this.LogLevel.INFO,g)},warn:function(g){this.log(this.LogLevel.WARN,g)},error:function(g){this.log(this.LogLevel.ERROR,g)},fatal:function(g){this.log(this.LogLevel.FATAL,g)},serialize:function(j){var g;if(!j){return null}if(typeof(j.tree)==="function"){j=j.tree()}var l=j.nodeName;var h,k;if(j.getAttribute("_realname")){l=j.getAttribute("_realname")}g="<"+l;for(h=0;h<j.attributes.length;h++){if(j.attributes[h].nodeName!="_realname"){g+=" "+j.attributes[h].nodeName.toLowerCase()+"='"+j.attributes[h].value.replace(/&/g,"&amp;").replace(/\'/g,"&apos;").replace(/</g,"&lt;")+"'"}}if(j.childNodes.length>0){g+=">";for(h=0;h<j.childNodes.length;h++){k=j.childNodes[h];if(k.nodeType==e.ElementType.NORMAL){g+=e.serialize(k)}else{if(k.nodeType==e.ElementType.TEXT){g+=k.nodeValue}}}g+="</"+l+">"}else{g+="/>"}return g},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(g,h){e._connectionPlugins[g]=h}};e.Builder=function(h,g){if(h=="presence"||h=="message"||h=="iq"){if(g&&!g.xmlns){g.xmlns=e.NS.CLIENT}else{if(!g){g={xmlns:e.NS.CLIENT}}}}this.nodeTree=e.xmlElement(h,g);this.node=this.nodeTree};e.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return e.serialize(this.nodeTree)},up:function(){this.node=this.node.parentNode;return this},attrs:function(h){for(var g in h){if(h.hasOwnProperty(g)){this.node.setAttribute(g,h[g])}}return this},c:function(h,g){var j=e.xmlElement(h,g);this.node.appendChild(j);this.node=j;return this},cnode:function(h){var j=e.xmlGenerator();var g=j.importNode?j.importNode(h,true):e.copyElement(h);this.node.appendChild(g);this.node=g;return this},t:function(g){var h=e.xmlTextNode(g);this.node.appendChild(h);return this}};e.Handler=function(l,k,h,j,n,m,g){this.handler=l;this.ns=k;this.name=h;this.type=j;this.id=n;this.options=g||{matchbare:false};if(!this.options.matchBare){this.options.matchBare=false}if(this.options.matchBare){this.from=m?e.getBareJidFromJid(m):null}else{this.from=m}this.user=true};e.Handler.prototype={isMatch:function(h){var k;var j=null;if(this.options.matchBare){j=e.getBareJidFromJid(h.getAttribute("from"))}else{j=h.getAttribute("from")}k=false;if(!this.ns){k=true}else{var g=this;e.forEachChild(h,null,function(l){if(l.getAttribute("xmlns")==g.ns){k=true}});k=k||h.getAttribute("xmlns")==this.ns}if(k&&(!this.name||e.isTagEqual(h,this.name))&&(!this.type||h.getAttribute("type")==this.type)&&(!this.id||h.getAttribute("id")==this.id)&&(!this.from||j==this.from)){return true}return false},run:function(h){var g=null;try{g=this.handler(h)}catch(j){if(j.sourceURL){e.fatal("error: "+this.handler+" "+j.sourceURL+":"+j.line+" - "+j.name+": "+j.message)}else{if(j.fileName){if(typeof(console)!="undefined"){console.trace();console.error(this.handler," - error - ",j,j.message)}e.fatal("error: "+this.handler+" "+j.fileName+":"+j.lineNumber+" - "+j.name+": "+j.message)}else{e.fatal("error: "+this.handler)}}throw j}return g},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}};e.TimedHandler=function(h,g){this.period=h;this.handler=g;this.lastCalled=new Date().getTime();this.user=true};e.TimedHandler.prototype={run:function(){this.lastCalled=new Date().getTime();return this.handler()},reset:function(){this.lastCalled=new Date().getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}};e.Connection=function(g){if(g.protocol){this.protocol=g.protocol}else{console.log("Warning : this syntax will be deprecated to leave room for othe protocols. Please use new Strophe.Connection({proto : new Strophe.Bosh(BOSH_SERVICE)})");this.protocol=new e.Bosh(g)}this.jid="";this.features=null;this.do_session=false;this.do_bind=false;this.timedHandlers=[];this.handlers=[];this.removeTimeds=[];this.removeHandlers=[];this.addTimeds=[];this.addHandlers=[];this.authenticated=false;this.disconnecting=false;this.connected=false;this.status=null;this._stanzas=[];this.errors=0;this._uniqueId=Math.round(Math.random()*10000);this._sasl_success_handler=null;this._sasl_failure_handler=null;this._sasl_challenge_handler=null;this._throttle_stanzas_handler=null;this.max_stanzas_per_second=10;for(var h in e._connectionPlugins){if(e._connectionPlugins.hasOwnProperty(h)){var l=e._connectionPlugins[h];var j=function(){};j.prototype=l;this[h]=new j();this[h].init(this)}}};e.Connection.prototype={reset:function(){this.do_session=false;this.do_bind=false;this.timedHandlers=[];this.handlers=[];this.removeTimeds=[];this.removeHandlers=[];this.addTimeds=[];this.addHandlers=[];this.authenticated=false;this.disconnecting=false;this.connected=false;this.status=null;this.errors=0;this._uniqueId=Math.round(Math.random()*10000)},getUniqueId:function(g){if(typeof(g)=="string"||typeof(g)=="number"){return ++this._uniqueId+":"+g}else{return ++this._uniqueId+""}},connect:function(g,h,l,k,j){this.jid=g;this.pass=h;this.connect_callback=l;this.disconnecting=false;this.connected=false;this.authenticated=false;this.errors=0;this.domain=e.getDomainFromJid(this.jid);this.protocol.connect(this);this.changeConnectStatus(e.Status.CONNECTING,null);this._throttleStanzas()},start:function(){this.send(c("stream:stream",{to:this.domain,xmlns:"jabber:client","xmlns:stream":"http://etherx.jabber.org/streams",version:"1.0"}).tree())},xmlInput:function(g){return},xmlOutput:function(g){return},rawInput:function(g){return},rawOutput:function(g){return},send:function(h){if(h===null){return}if(typeof(h.sort)==="function"){for(var g=0;g<h.length;g++){if(this._ensureDOMElement(h[g])){this._stanzas.push(h[g])}}}else{if(typeof(h.tree)==="function"){if(this._ensureDOMElement(h.tree())){this._stanzas.push(h.tree())}}else{if(this._ensureDOMElement(h)){this._stanzas.push(h)}}}},sendIQ:function(k,o,g,l){var m=null;var j=this;if(typeof(k.tree)==="function"){k=k.tree()}var n=k.getAttribute("id");if(!n){n=this.getUniqueId("sendIQ");k.setAttribute("id",n)}var h=this.addHandler(function(q){if(m){j.deleteTimedHandler(m)}var p=q.getAttribute("type");if(p=="result"){if(o){o(q)}}else{if(p=="error"){if(g){g(q)}}else{throw {name:"StropheError",message:"Got bad IQ type of "+p}}}},null,"iq",null,n);if(l){m=this.addTimedHandler(l,function(){j.deleteHandler(h);if(g){g(null)}return false})}this.send(k);return n},_ensureDOMElement:function(g){if(g===null||!g.tagName||!g.childNodes){throw {name:"StropheError",message:"Cannot queue non-DOMElement."}}return true},addTimedHandler:function(j,h){var g=new e.TimedHandler(j,h);this.addTimeds.push(g);return g},deleteTimedHandler:function(g){this.removeTimeds.push(g)},addHandler:function(m,l,j,k,o,n,h){var g=new e.Handler(m,l,j,k,o,n,h);this.addHandlers.push(g);return g},deleteHandler:function(g){this.removeHandlers.push(g)},disconnect:function(g){e.info("Disconnect was called because: "+g);this.changeConnectStatus(e.Status.DISCONNECTING,g);if(this.connected){this.disconnecting=true;this._disconnectTimeout=this._addSysTimedHandler(3000,this._onDisconnectTimeout.bind(this));if(this.authenticated){this.send(b({xmlns:e.NS.CLIENT,type:"unavailable"}))}this.protocol.disconnect()}},changeConnectStatus:function(g,n){this.status=g;for(var h in e._connectionPlugins){if(e._connectionPlugins.hasOwnProperty(h)){var l=this[h];if(l.statusChanged){try{l.statusChanged(g,n)}catch(j){e.error(""+h+" plugin caused an exception changing status: "+j)}}}}if(this.connect_callback){try{this.connect_callback(g,n)}catch(m){e.error("User connection callback caused an exception: "+m)}}},_doDisconnect:function(){e.info("_doDisconnect was called");this.protocol.finish();this.changeConnectStatus(e.Status.DISCONNECTED,null);this.connected=false;this.handlers=[];this.timedHandlers=[];this.removeTimeds=[];this.removeHandlers=[];this.addTimeds=[];this.addHandlers=[]},receiveData:function(j){var q=false;var k=false;var p=false;this.connected=true;if(j===null){return}this.xmlInput(j);var m,l;while(this.removeHandlers.length>0){l=this.removeHandlers.pop();m=this.handlers.indexOf(l);if(m>=0){this.handlers.splice(m,1)}}while(this.addHandlers.length>0){this.handlers.push(this.addHandlers.pop())}var m,g;g=this.handlers;this.handlers=[];for(m=0;m<g.length;m++){var l=g[m];if(l.isMatch(j)&&(this.authenticated||!l.user)){if(l.run(j)){this.handlers.push(l)}}else{this.handlers.push(l)}}var r=j.getElementsByTagName("mechanism");var m,o,n,h;console.log(r);if(r.length>0){for(m=0;m<r.length;m++){o=e.getText(r[m]);console.log(o);if(o=="DIGEST-MD5"){k=true}else{if(o=="PLAIN"){q=true}else{if(o=="ANONYMOUS"){p=true}}}}}console.log(k,q,p);if(this.status==e.Status.CONNECTING){this.changeConnectStatus(e.Status.AUTHENTICATING,null);console.log(e.getNodeFromJid(this.jid),p);console.log(k,q);if(e.getNodeFromJid(this.jid)===null&&p){this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null);this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);this.send(c("auth",{xmlns:e.NS.SASL,mechanism:"ANONYMOUS"}).tree())}else{if(e.getNodeFromJid(this.jid)===null){this.changeConnectStatus(e.Status.CONNFAIL,"x-strophe-bad-non-anon-jid");this.disconnect()}else{if(k){this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge1_cb.bind(this),null,"challenge",null,null);this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);this.send(c("auth",{xmlns:e.NS.SASL,mechanism:"DIGEST-MD5"}).tree())}else{if(q){n=unescape(encodeURIComponent(e.getBareJidFromJid(this.jid)));n=n+"\u0000";n=n+unescape(encodeURIComponent(e.getNodeFromJid(this.jid)));n=n+"\u0000";n=n+this.pass;this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null);this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);h=Base64.encode(n);this.send(c("auth",{xmlns:e.NS.SASL,mechanism:"PLAIN"}).t(h).tree())}else{this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1");this.send(d({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:e.NS.AUTH}).c("username",{}).t(e.getNodeFromJid(this.jid)).tree())}}}}}},_sasl_challenge1_cb:function(l){var h=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/;var r=Base64.decode(e.getText(l));var s=MD5.hexdigest(Math.random()*1234567890);var o="";var t=null;var p="";var g="";var n;this.deleteHandler(this._sasl_failure_handler);while(r.match(h)){n=r.match(h);r=r.replace(n[0],"");n[2]=n[2].replace(/^"(.+)"$/,"$1");switch(n[1]){case"realm":o=n[2];break;case"nonce":p=n[2];break;case"qop":g=n[2];break;case"host":t=n[2];break}}var m="xmpp/"+this.domain;if(t!==null){m=m+"/"+t}var k=MD5.hash(unescape(encodeURIComponent(e.getNodeFromJid(this.jid)))+":"+o+":"+this.pass)+":"+p+":"+s;var j="AUTHENTICATE:"+m;var q="";q+="username="+this._quote(unescape(encodeURIComponent(e.getNodeFromJid(this.jid))))+",";q+="realm="+this._quote(o)+",";q+="nonce="+this._quote(p)+",";q+="cnonce="+this._quote(s)+",";q+='nc="00000001",';q+='qop="auth",';q+="digest-uri="+this._quote(m)+",";q+="response="+this._quote(MD5.hexdigest(MD5.hexdigest(k)+":"+p+":00000001:"+s+":auth:"+MD5.hexdigest(j)))+",";q+='charset="utf-8"';this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge2_cb.bind(this),null,"challenge",null,null);this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null);this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);this.send(c("response",{xmlns:e.NS.SASL}).t(Base64.encode(q)).tree());return false},_quote:function(g){return'"'+g.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},_sasl_challenge2_cb:function(g){this.deleteHandler(this._sasl_success_handler);this.deleteHandler(this._sasl_failure_handler);this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null);this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);this.send(c("response",{xmlns:e.NS.SASL}).tree());return false},_auth1_cb:function(g){var h=d({type:"set",id:"_auth_2"}).c("query",{xmlns:e.NS.AUTH}).c("username",{}).t(e.getNodeFromJid(this.jid)).up().c("password").t(this.pass);if(!e.getResourceFromJid(this.jid)){this.jid=e.getBareJidFromJid(this.jid)+"/strophe"}h.up().c("resource",{}).t(e.getResourceFromJid(this.jid));this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2");this.send(h.tree());return false},_sasl_success_cb:function(g){e.info("SASL authentication succeeded.");this.deleteHandler(this._sasl_failure_handler);this._sasl_failure_handler=null;if(this._sasl_challenge_handler){this.deleteHandler(this._sasl_challenge_handler);this._sasl_challenge_handler=null}this._addSysHandler(this._sasl_auth1_cb.bind(this),null,"stream:features",null,null);this.protocol.restart();return false},_sasl_auth1_cb:function(h){this.features=h;var g,k;for(g=0;g<h.childNodes.length;g++){k=h.childNodes[g];if(k.nodeName=="bind"){this.do_bind=true}if(k.nodeName=="session"){this.do_session=true}}if(!this.do_bind){this.changeConnectStatus(e.Status.AUTHFAIL,null);return false}else{this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2");var j=e.getResourceFromJid(this.jid);if(j){this.send(d({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:e.NS.BIND}).c("resource",{}).t(j).tree())}else{this.send(d({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:e.NS.BIND}).tree())}}return false},_sasl_bind_cb:function(g){if(g.getAttribute("type")=="error"){e.info("SASL binding failed.");this.changeConnectStatus(e.Status.AUTHFAIL,null);return false}var j=g.getElementsByTagName("bind");var h;if(j.length>0){h=j[0].getElementsByTagName("jid");if(h.length>0){this.jid=e.getText(h[0]);if(this.do_session){this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2");this.send(d({type:"set",id:"_session_auth_2"}).c("session",{xmlns:e.NS.SESSION}).tree())}else{this.authenticated=true;this.changeConnectStatus(e.Status.CONNECTED,null)}}}else{e.info("SASL binding failed.");this.changeConnectStatus(e.Status.AUTHFAIL,null);return false}},_sasl_session_cb:function(g){if(g.getAttribute("type")=="result"){this.authenticated=true;this.changeConnectStatus(e.Status.CONNECTED,null)}else{if(g.getAttribute("type")=="error"){e.info("Session creation failed.");this.changeConnectStatus(e.Status.AUTHFAIL,null);return false}}return false},_sasl_failure_cb:function(g){if(this._sasl_success_handler){this.deleteHandler(this._sasl_success_handler);this._sasl_success_handler=null}if(this._sasl_challenge_handler){this.deleteHandler(this._sasl_challenge_handler);this._sasl_challenge_handler=null}this._doDisconnect();this.changeConnectStatus(e.Status.AUTHFAIL,null);return false},_auth2_cb:function(g){if(g.getAttribute("type")=="result"){this.authenticated=true;this.changeConnectStatus(e.Status.CONNECTED,null)}else{if(g.getAttribute("type")=="error"){this.changeConnectStatus(e.Status.AUTHFAIL,null);this.disconnect()}}return false},_addSysTimedHandler:function(j,h){var g=new e.TimedHandler(j,h);g.user=false;this.addTimeds.push(g);return g},_addSysHandler:function(l,k,h,j,m){var g=new e.Handler(l,k,h,j,m);g.user=false;this.addHandlers.push(g);return g},_onDisconnectTimeout:function(){e.info("_onDisconnectTimeout was called");this._doDisconnect();return false},_throttleStanzas:function(){stanza=this._stanzas.shift();if(stanza){this.protocol.send(stanza)}this._throttle_stanzas_handler=setTimeout(this._throttleStanzas.bind(this),100*1/this.max_stanzas_per_second)}};if(f){f(e,c,a,d,b)}})(function(){window.Strophe=arguments[0];window.$build=arguments[1];window.$msg=arguments[2];window.$iq=arguments[3];window.$pres=arguments[4]});Strophe.Request=function(c,b,a,d){this.id=++Strophe._requestId;this.xmlData=c;this.data=Strophe.serialize(c);this.origFunc=b;this.func=b;this.rid=a;this.date=NaN;this.sends=d||0;this.abort=false;this.dead=null;this.age=function(){if(!this.date){return 0}var e=new Date();return(e-this.date)/1000};this.timeDead=function(){if(!this.dead){return 0}var e=new Date();return(e-this.dead)/1000};this.xhr=this._newXHR()};Strophe.NS.HTTPBIND="http://jabber.org/protocol/httpbind",Strophe.NS.BOSH="urn:xmpp:xbosh",Strophe.Request.prototype={getResponse:function(){var a=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){a=this.xhr.responseXML.documentElement;if(a.tagName=="parsererror"){Strophe.error("invalid response received");Strophe.error("responseText: "+this.xhr.responseText);Strophe.error("responseXML: "+Strophe.serialize(this.xhr.responseXML));throw"parsererror"}}else{if(this.xhr.responseText){Strophe.error("invalid response received");Strophe.error("responseText: "+this.xhr.responseText);Strophe.error("responseXML: "+Strophe.serialize(this.xhr.responseXML))}}return a},_newXHR:function(){var a=null;if(window.XMLHttpRequest){a=new XMLHttpRequest();if(a.overrideMimeType){a.overrideMimeType("text/xml")}}else{if(window.ActiveXObject){a=new ActiveXObject("Microsoft.XMLHTTP")}}a.onreadystatechange=this.func.bind(null,this);return a}};Strophe.Bosh=function(a){this.service=a;this.rid=Math.floor(Math.random()*4294967295);this.sid=null;this.streamId=null;this.hold=1;this.wait=3;this.window=5;this.connection=null;this._requests=[];this._sendNextRequestTimeout=null;this.connected=false;this.disconnecting=false};Strophe.Bosh.prototype={TIMEOUT:1.1,SECONDARY_TIMEOUT:0.1,connect:function(a){this.connection=a;this.connected=true;this.disconnecting=false;body=this._buildBody();body.attrs({to:this.connection.domain,wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8","xml:lang":"en",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":"urn:xmpp:xbosh"});this._requests.push(body);this._sendNextRequestTimeout=setTimeout(this._sendNextRequest.bind(this),100)},disconnect:function(){this.disconnecting=true;body=this._buildBody();body.attrs({type:"terminate"});this._requests.push(body)},send:function(a){body=this._buildBody();body.cnode(a);while(body.nodeTree!=body.node){body.up()}this._requests.push(body)},attach:function(c,a,d,g,f,e,b){this.jid=c;this.sid=a;this.rid=d;this.connect_callback=g;this.domain=Strophe.getDomainFromJid(this.jid);this.authenticated=true;this.connected=true;this.wait=f||this.wait;this.hold=e||this.hold;this.window=b||this.window;this.changeConnectStatus(Strophe.Status.ATTACHED,null)},_buildBody:function(){var a=$build("body",{xmlns:Strophe.NS.HTTPBIND});return a},_sendNextRequest:function(){body=this._requests.shift();if(!body){body=this._buildBody()}body.attrs({rid:this.rid++});if(this.sid!==null){body.attrs({sid:this.sid})}request=new Strophe.Request(body.tree(),this._onRequestStateChange.bind(this,this._dataRecv.bind(this)),body.tree().getAttribute("rid"));if(this.connected){this._processRequest(request)}},_processRequest:function(j){var m=-1;try{if(j.xhr.readyState==4){m=j.xhr.status}}catch(g){Strophe.error("caught an error in _requests["+i+"], reqStatus: "+m)}if(typeof(m)=="undefined"){m=-1}if(j.sends>5){this._onDisconnectTimeout();return}var c=j.age();var b=(!isNaN(c)&&c>Math.floor(Strophe.Bosh.TIMEOUT*this.wait));var d=(j.dead!==null&&j.timeDead()>Math.floor(Strophe.Bosh.SECONDARY_TIMEOUT*this.wait));var l=(j.xhr.readyState==4&&(m<1||m>=500));if(b||d||l){if(d){Strophe.error("Request "+this._requests[i].id+" timed out (secondary), restarting")}j.abort=true;j.xhr.abort();j.xhr.onreadystatechange=function(){};this._requests[i]=new Strophe.Request(j.xmlData,j.origFunc,j.rid,j.sends);j=this._requests[i]}if(j.xhr.readyState===0){Strophe.debug("request id "+j.id+"."+j.sends+" posting");j.date=new Date();try{var a=!("sync" in this&&this.sync===true);j.xhr.open("POST",this.service,a)}catch(h){Strophe.error("XHR open failed.");if(!this.connected){this.connection.changeConnectStatus(Strophe.Status.CONNFAIL,"bad-service")}this.connection._doDisconnect();return}var k=function(){j.xhr.send(j.data)};if(j.sends>1){var f=Math.pow(j.sends,3)*1000;setTimeout(k,f)}else{k()}j.sends++;this.connection.xmlOutput(j.xmlData);this.connection.rawOutput(j.data)}else{Strophe.debug("_processRequest: "+(i===0?"first":"second")+" request has readyState of "+j.xhr.readyState)}},_dataRecv:function(l){clearTimeout(this._sendNextRequestTimeout);this._sendNextRequestTimeout=setTimeout(this._sendNextRequest.bind(this),100);try{var c=l.getResponse()}catch(j){if(j!="parsererror"){throw j}this.disconnect("strophe-parsererror")}if(c===null){return}this.connection.xmlInput(c);this.connection.rawInput(Strophe.serialize(c));var d=c.getAttribute("type");var k,f;if(this.disconnecting||(d!==null&&d=="terminate")){if(this.connection.disconnecting){this.connection._doDisconnect();return}this.sid=null;k=c.getAttribute("condition");f=c.getElementsByTagName("conflict");if(k!==null){if(k=="remote-stream-error"&&f.length>0){k="conflict"}this.connection.changeConnectStatus(Strophe.Status.CONNFAIL,k)}else{this.connection.changeConnectStatus(Strophe.Status.CONNFAIL,"unknown")}return}if(!this.sid){this.sid=c.getAttribute("sid")}if(!this.stream_id){this.stream_id=c.getAttribute("authid")}var b=c.getAttribute("requests");if(b){this.window=parseInt(b,10)}var a=c.getAttribute("hold");if(a){this.hold=parseInt(a,10)}var g=c.getAttribute("wait");if(g){this.wait=parseInt(g,10)}var h=this;Strophe.forEachChild(c,null,function(e){h.connection.receiveData(e)})},_onRequestStateChange:function(d,c){Strophe.debug("request id "+c.id+"."+c.sends+" state changed to "+c.xhr.readyState);if(c.abort){c.abort=false;return}var b;if(c.xhr.readyState==4){b=0;try{b=c.xhr.status}catch(f){}if(typeof(b)=="undefined"){b=0}if(this.disconnecting){if(b>=400){this._hitError(b);return}}var a=(this._requests[0]==c);var g=(this._requests[1]==c);if(b==200){if(g||(a&&this._requests.length>0&&this._requests[0].age()>Math.floor(Strophe.Bosh.SECONDARY_TIMEOUT*this.wait))){this._restartRequest(0)}Strophe.debug("request id "+c.id+"."+c.sends+" got 200");d(c);this.errors=0}else{Strophe.error("request id "+c.id+"."+c.sends+" error "+b+" happened");if(b===0||(b>=400&&b<600)||b>=12000){this._hitError(b);if(b>=400&&b<500){this.connection.disconnect()}}}if(!((b>0&&b<500)||c.sends>5)){}}},restart:function(){body=this._buildBody();body.attrs({to:this.connection.domain,"xml:lang":"en",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":"urn:xmpp:xbosh","xmpp:restart":true});this._requests.push(body)},_hitError:function(a){this.errors++;Strophe.warn("request errored, status: "+a+", number of errors: "+this.errors);if(this.errors>4){this._onDisconnectTimeout()}},finish:function(){Strophe.info("bosh::finish was called");this.connected=false;this.sid=null;this.streamId=null;this.rid=Math.floor(Math.random()*4294967295)},};Strophe.SocketIO=function(b,a){this.connection=null;this.service=b;this.port=a;this._requests=[];this.connected=false};Strophe.SocketIO.prototype={connect:function(a){if(!this.socket){this.connection=a;this.socket=new io.Socket(this.host,{port:this.port});this.socket.on("connect",function(){this._onConnect()}.bind(this));this.socket.on("message",function(b){this._onMessage(b)}.bind(this));this.socket.on("disconnect",function(){this._onDisconnect()}.bind(this));this.socket.connect()}},disconnect:function(){console.log("disconnected")},finish:function(){console.log("finish")},send:function(a){console.log("send")},restart:function(){console.log("restart")},_onMessage:function(a){string=a.data.replace("<stream:features>","<stream:features xmlns:stream='http://etherx.jabber.org/streams'>");parser=new DOMParser();elem=parser.parseFromString(string,"text/xml").documentElement;this.connection.xmlInput(elem);this.connection.rawInput(Strophe.serialize(elem));if(elem.nodeName=="stream:stream"){}else{this.connection.receiveData(elem)}},_onConnect:function(){Strophe.log("SocketIO open");this.connection.xmlOutput(this._startStream());this.connection.rawOutput(this._startStream());this.socket.send(this._startStream())},_onDisconnect:function(a){Strophe.log("SocketIO disconnected");this.connection._doDisconnect()},_startStream:function(){return"<stream:stream to='"+this.connection.domain+"' xmlns='jabber:client' xmlns:stream='http://etherx.jabber.org/streams' version='1.0' />"},_endStream:function(){return"</stream:stream>"}};if(typeof(DOMParser)=="undefined"){DOMParser=function(){};DOMParser.prototype.parseFromString=function(b,c){if(typeof(ActiveXObject)!="undefined"){var a=new ActiveXObject("MSXML.DomDocument");a.async=false;a.loadXML(b);return a}else{if(typeof(XMLHttpRequest)!="undefined"){var a=new XMLHttpRequest;if(!c){c="application/xml"}a.open("GET","data:"+c+";charset=utf-8,"+encodeURIComponent(b),false);if(a.overrideMimeType){a.overrideMimeType(c)}a.send(null);return a.responseXML}}}}Strophe.Websocket=function(a){this.connection=null;this.service=a;this._requests=[];this.connected=false};Strophe.Websocket.prototype={connect:function(a){if(!this.socket){this.connection=a;this.socket=new WebSocket(this.service,"xmpp");this.socket.onopen=this._onOpen.bind(this);this.socket.onerror=this._onError.bind(this);this.socket.onclose=this._onClose.bind(this);this.socket.onmessage=this._onMessage.bind(this)}},disconnect:function(){this.connection.xmlOutput(this._endStream());this.connection.rawOutput(this._endStream());this.socket.send(this._endStream());this.socket.close()},finish:function(){this.socket=null},send:function(a){this.connection.xmlOutput(a);this.connection.rawOutput(Strophe.serialize(a));this.socket.send(Strophe.serialize(a))},restart:function(){this.connection.xmlOutput(this._startStream());this.connection.rawOutput(this._startStream());this.socket.send(this._startStream())},_onError:function(a){Strophe.log("Websocket error "+a)},_onOpen:function(){Strophe.log("Websocket open");this.connection.xmlOutput(this._startStream());this.connection.rawOutput(this._startStream());this.socket.send(this._startStream())},_onClose:function(a){Strophe.log("Websocket disconnected");this.connection._doDisconnect()},_onMessage:function(a){string=a.data.replace("<stream:features>","<stream:features xmlns:stream='http://etherx.jabber.org/streams'>");parser=new DOMParser();elem=parser.parseFromString(string,"text/xml").documentElement;if(elem.nodeName!=="parsererror"){this.connection.xmlInput(elem);this.connection.rawInput(Strophe.serialize(elem));if(elem.nodeName=="stream:stream"){}else{this.connection.receiveData(elem)}}else{Strophe.log("Parserreror",elem)}},_startStream:function(){return"<stream:stream to='"+this.connection.domain+"' xmlns='jabber:client' xmlns:stream='http://etherx.jabber.org/streams' version='1.0' />"},_endStream:function(){return"</stream:stream>"}};Strophe.addConnectionPlugin("muc",{_connection:null,init:function(a){this._connection=a;Strophe.addNamespace("MUC_OWNER",Strophe.NS.MUC+"#owner");Strophe.addNamespace("MUC_ADMIN",Strophe.NS.MUC+"#admin")},join:function(g,a,c,d,b){var f=this.test_append_nick(g,a);var h=$pres({from:this._connection.jid,to:f}).c("x",{xmlns:Strophe.NS.MUC});if(b){var e=Strophe.xmlElement("password",[],b);h.cnode(e)}if(c){this._connection.addHandler(function(k){var l=k.getAttribute("from");var j=l.split("/");if(j[0]==g){return c(k)}else{return true}},null,"message",null,null,null)}if(d){this._connection.addHandler(function(k){var m=k.getElementsByTagName("x");if(m.length>0){for(var j=0;j<m.length;j++){var l=m[j].getAttribute("xmlns");if(l&&l.match(Strophe.NS.MUC)){return d(k)}}}return true},null,"presence",null,null,null)}this._connection.send(h)},leave:function(f,a,c){var e=this.test_append_nick(f,a);var d=this._connection.getUniqueId();var b=$pres({type:"unavailable",id:d,from:this._connection.jid,to:e}).c("x",{xmlns:Strophe.NS.MUC});this._connection.addHandler(c,null,"presence",null,d,null);this._connection.send(b);return d},message:function(f,a,d,b){var e=this.test_append_nick(f,a);b=b||"groupchat";var c=this._connection.getUniqueId();var g=$msg({to:e,from:this._connection.jid,type:b,id:c}).c("body",{xmlns:Strophe.NS.CLIENT}).t(d);g.up().c("x",{xmlns:"jabber:x:event"}).c("composing");this._connection.send(g);return c},configure:function(b){var a=$iq({to:b,type:"get"}).c("query",{xmlns:Strophe.NS.MUC_OWNER});var c=a.tree();return this._connection.sendIQ(c,function(){},function(){})},cancelConfigure:function(b){var a=$iq({to:b,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_OWNER}).c("x",{xmlns:"jabber:x:data",type:"cancel"});var c=a.tree();return this._connection.sendIQ(c,function(){},function(){})},saveConfiguration:function(d,c){var a=$iq({to:d,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_OWNER}).c("x",{xmlns:"jabber:x:data",type:"submit"});for(var b=0;b<c.length;b++){a.cnode(c[b]);a.up()}var e=a.tree();return this._connection.sendIQ(e,function(){},function(){})},createInstantRoom:function(b){var a=$iq({to:b,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_OWNER}).c("x",{xmlns:"jabber:x:data",type:"submit"});return this._connection.sendIQ(a.tree(),function(){},function(){})},setTopic:function(b,a){var c=$msg({to:b,from:this._connection.jid,type:"groupchat"}).c("subject",{xmlns:"jabber:client"}).t(a);this._connection.send(c.tree())},modifyUser:function(g,b,h,d,f){var a={nick:Strophe.escapeNode(b)};if(h!==null){a.role=h}if(d!==null){a.affiliation=d}var e=$build("item",a);if(f!==null){e.cnode(Strophe.xmlElement("reason",f))}var c=$iq({to:g,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_OWNER}).cnode(e.tree());return this._connection.sendIQ(c.tree(),function(){},function(){})},changeNick:function(d,a){var c=this.test_append_nick(d,a);var b=$pres({from:this._connection.jid,to:c}).c("x",{xmlns:Strophe.NS.MUC});this._connection.send(b.tree())},listRooms:function(c,a){var b=$iq({to:c,from:this._connection.jid,type:"get"}).c("query",{xmlns:Strophe.NS.DISCO_ITEMS});this._connection.sendIQ(b,a,function(){})},test_append_nick:function(c,a){var b=c;if(a){b+="/"+Strophe.escapeNode(a)}return b}});var Mustache=function(){var a=function(){};a.prototype={otag:"{{",ctag:"}}",pragmas:{},buffer:[],pragmas_implemented:{"IMPLICIT-ITERATOR":true},context:{},render:function(e,d,c,f){if(!f){this.context=d;this.buffer=[]}if(!this.includes("",e)){if(f){return e}else{this.send(e);return}}e=this.render_pragmas(e);var b=this.render_section(e,d,c);if(f){return this.render_tags(b,d,c,f)}this.render_tags(b,d,c,f)},send:function(b){if(b!==""){this.buffer.push(b)}},render_pragmas:function(b){if(!this.includes("%",b)){return b}var d=this;var c=new RegExp(this.otag+"%([\\w-]+) ?([\\w]+=[\\w]+)?"+this.ctag,"g");return b.replace(c,function(g,e,f){if(!d.pragmas_implemented[e]){throw ({message:"This implementation of mustache doesn't understand the '"+e+"' pragma"})}d.pragmas[e]={};if(f){var h=f.split("=");d.pragmas[e][h[0]]=h[1]}return""})},render_partial:function(b,d,c){b=this.trim(b);if(!c||c[b]===undefined){throw ({message:"unknown_partial '"+b+"'"})}if(typeof(d[b])!="object"){return this.render(c[b],d,c,true)}return this.render(c[b],d[b],c,true)},render_section:function(d,c,b){if(!this.includes("#",d)&&!this.includes("^",d)){return d}var f=this;var e=new RegExp(this.otag+"(\\^|\\#)\\s*(.+)\\s*"+this.ctag+"\n*([\\s\\S]+?)"+this.otag+"\\/\\s*\\2\\s*"+this.ctag+"\\s*","mg");return d.replace(e,function(h,j,g,k){var l=f.find(g,c);if(j=="^"){if(!l||f.is_array(l)&&l.length===0){return f.render(k,c,b,true)}else{return""}}else{if(j=="#"){if(f.is_array(l)){return f.map(l,function(m){return f.render(k,f.create_context(m),b,true)}).join("")}else{if(f.is_object(l)){return f.render(k,f.create_context(l),b,true)}else{if(typeof l==="function"){return l.call(c,k,function(m){return f.render(m,c,b,true)})}else{if(l){return f.render(k,c,b,true)}else{return""}}}}}}})},render_tags:function(k,b,d,f){var e=this;var j=function(){return new RegExp(e.otag+"(=|!|>|\\{|%)?([^\\/#\\^]+?)\\1?"+e.ctag+"+","g")};var g=j();var h=function(o,m,n){switch(m){case"!":return"";case"=":e.set_delimiters(n);g=j();return"";case">":return e.render_partial(n,b,d);case"{":return e.find(n,b);default:return e.escape(e.find(n,b))}};var l=k.split("\n");for(var c=0;c<l.length;c++){l[c]=l[c].replace(g,h,this);if(!f){this.send(l[c])}}if(f){return l.join("\n")}},set_delimiters:function(c){var b=c.split(" ");this.otag=this.escape_regex(b[0]);this.ctag=this.escape_regex(b[1])},escape_regex:function(c){if(!arguments.callee.sRE){var b=["/",".","*","+","?","|","(",")","[","]","{","}","\\"];arguments.callee.sRE=new RegExp("(\\"+b.join("|\\")+")","g")}return c.replace(arguments.callee.sRE,"\\$1")},find:function(c,d){c=this.trim(c);function b(f){return f===false||f===0||f}var e;if(b(d[c])){e=d[c]}else{if(b(this.context[c])){e=this.context[c]}}if(typeof e==="function"){return e.apply(d)}if(e!==undefined){return e}return""},includes:function(c,b){return b.indexOf(this.otag+c)!=-1},escape:function(b){b=String(b===null?"":b);return b.replace(/&(?!\w+;)|["'<>\\]/g,function(c){switch(c){case"&":return"&amp;";case"\\":return"\\\\";case'"':return"&quot;";case"'":return"&#39;";case"<":return"&lt;";case">":return"&gt;";default:return c}})},create_context:function(c){if(this.is_object(c)){return c}else{var d=".";if(this.pragmas["IMPLICIT-ITERATOR"]){d=this.pragmas["IMPLICIT-ITERATOR"].iterator}var b={};b[d]=c;return b}},is_object:function(b){return b&&typeof b=="object"},is_array:function(b){return Object.prototype.toString.call(b)==="[object Array]"},trim:function(b){return b.replace(/^\s*|\s*$/g,"")},map:function(f,d){if(typeof f.map=="function"){return f.map(d)}else{var e=[];var b=f.length;for(var c=0;c<b;c++){e.push(d(f[c]))}return e}}};return({name:"mustache.js",version:"0.3.1-dev",to_html:function(d,b,c,f){var e=new a();if(f){e.send=f}e.render(d,b,c);if(!f){return e.buffer.join("\n")}}})}();(function(a){a.i18n={dict:null,setDictionary:function(b){this.dict=b},_:function(d,c){var b=d;if(this.dict&&this.dict[d]){b=this.dict[d]}return this.printf(b,c)},toEntity:function(d){var b="";for(var c=0;c<d.length;c++){if(d.charCodeAt(c)>128){b+="&#"+d.charCodeAt(c)+";"}else{b+=d.charAt(c)}}return b},stripStr:function(b){return b.replace(/^\s*/,"").replace(/\s*$/,"")},stripStrML:function(d){var c=d.split("\n");for(var b=0;b<c.length;b++){c[b]=stripStr(c[b])}return stripStr(c.join(" "))},printf:function(g,b){if(!b){return g}var f="",e=/%(\d+)\$s/g;while(result=e.exec(g)){var c=parseInt(result[1],10)-1;g=g.replace("%"+result[1]+"$s",(b[c]));b.splice(c,1)}var h=g.split("%s");if(h.length>1){for(var d=0;d<b.length;d++){if(h[d].lastIndexOf("%")==h[d].length-1&&d!=b.length-1){h[d]+="s"+h.splice(d+1,1)[0]}f+=h[d]+b[d]}}return f+h[h.length-1]}};a.fn._t=function(c,b){return a(this).text(a.i18n._(c,b))}})(jQuery);var dateFormat=function(){var a=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,b=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,d=/[^-+\dA-Z]/g,c=function(f,e){f=String(f);e=e||2;while(f.length<e){f="0"+f}return f};return function(j,w,r){var g=dateFormat;if(arguments.length==1&&Object.prototype.toString.call(j)=="[object String]"&&!/\d/.test(j)){w=j;j=undefined}j=j?new Date(j):new Date;if(isNaN(j)){throw SyntaxError("invalid date")}w=String(g.masks[w]||w||g.masks["default"]);if(w.slice(0,4)=="UTC:"){w=w.slice(4);r=true}var u=r?"getUTC":"get",n=j[u+"Date"](),e=j[u+"Day"](),k=j[u+"Month"](),q=j[u+"FullYear"](),t=j[u+"Hours"](),l=j[u+"Minutes"](),v=j[u+"Seconds"](),p=j[u+"Milliseconds"](),f=r?0:j.getTimezoneOffset(),h={d:n,dd:c(n),ddd:g.i18n.dayNames[e],dddd:g.i18n.dayNames[e+7],m:k+1,mm:c(k+1),mmm:g.i18n.monthNames[k],mmmm:g.i18n.monthNames[k+12],yy:String(q).slice(2),yyyy:q,h:t%12||12,hh:c(t%12||12),H:t,HH:c(t),M:l,MM:c(l),s:v,ss:c(v),l:c(p,3),L:c(p>99?Math.round(p/10):p),t:t<12?"a":"p",tt:t<12?"am":"pm",T:t<12?"A":"P",TT:t<12?"AM":"PM",Z:r?"UTC":(String(j).match(b)||[""]).pop().replace(d,""),o:(f>0?"-":"+")+c(Math.floor(Math.abs(f)/60)*100+Math.abs(f)%60,4),S:["th","st","nd","rd"][n%10>3?0:(n%100-n%10!=10)*n%10]};return w.replace(a,function(m){return m in h?h[m]:m.slice(1,m.length-1)})}}();dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"};dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};Date.prototype.format=function(a,b){return dateFormat(this,a,b)};